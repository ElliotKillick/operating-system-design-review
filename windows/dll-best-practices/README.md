# DLL Best Practices

The "DLL Best Practices" whitepaper is the Microsoft Corporation's original guidance laying out DLL best practices for the Windows platform, namely regarding `DllMain`.

The document was authored by Microsoft engineers, likely with cooperation from the [product manager (PM)](https://medium.com/@adiagashe/microsoft-program-manager-overview-everything-you-need-to-know-from-application-to-interview-33eab7fb0dde) [who, at the time, owned the DLL loader](https://learn.microsoft.com/en-us/archive/blogs/larryosterman/best-practices-for-dllmain) ([blog announcement #2](https://learn.microsoft.com/en-us/archive/blogs/matt_pietrek/finally-some-more-concrete-guidance-on-the-mysterys-of-dllmain)). In my opinion, the document was good for its time, except for the main "General Best Practices" section, which throws rules at you without any structure or reasoning. People reading the old `DllMain` "General Best Practices" today (on Microsoft's documentation website, which has undergone a few updates) tend to come out more confused about `DllMain` safety than they were before. So, let's rewrite it with the perspective of an ecosystem where `DllMain` (module initializer/finalizer or constructor/destructor in the module scope) problems don't happen to begin with. **Enter... Unix-like operating systems!**

Something worth pointing out is that Old New Thing author Raymond Chen [didn't condone referencing his work in the official "DLL Best Practices" whitepaper](https://devblogs.microsoft.com/oldnewthing/20070810-00/?p=25623). Many years have passed since this original statement; however, his extensive Windows experience inside Microsoft makes it nearly impossible not to reference his abundance of work in an educational manner, especially for someone outside of Microsoft who, in the grand scheme of Windows, knows little to nothing about Windows internals like myself (not that anyone could have a firm grasp on the whole of a project that's as large as Windows, but you get what I mean).

Be mindful of the fact that my critiques apply only to the software or company itself and not to the people who contribute to its development. I appreciate and respect the people who put hard work into creating the technologies. Thank you!

**Note:** This old document states the following about loader lock: "Any function that must read or modify the per-process library-loader data structures must acquire this lock before performing such an operation" (in addition to protecting module initialization/deinitialization). This fact was only true of the legacy Windows loader (e.g. see ReactOS code based on the reverse engineered Windows Server 2003 loader). The modern Windows loader protects library-loader data structures using the `LdrpModuleDatatableLock` lock. The age of this document also makes it inapplicable to the modern Windows loader in other ways (this amendment is by no means comprehensive).

[Current official Microsoft document download](https://download.microsoft.com/download/a/f/7/af7777e5-7dcd-4800-8a0a-b18336565f5b/DLL_bestprac.doc) | [Current official Microsoft document web view](https://view.officeapps.live.com/op/view.aspx?src=http%3A%2F%2Fdownload.microsoft.com%2Fdownload%2Fa%2Ff%2F7%2Faf7777e5-7dcd-4800-8a0a-b18336565f5b%2FDLL_bestprac.doc) | [Legacy download page archived](https://web.archive.org/web/20101029013644/http://www.microsoft.com/whdc/driver/kernel/DLL_bestprac.mspx)
