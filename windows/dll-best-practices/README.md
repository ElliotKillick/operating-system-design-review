# DLL Best Practices

This is Microsoft's original document laying out the DLL best practices, namely regarding `DllMain`.

The "DLL Best Practices" document was created by the [product manager (PM)](https://medium.com/@adiagashe/microsoft-program-manager-overview-everything-you-need-to-know-from-application-to-interview-33eab7fb0dde) [who owns (or at least owned) the DLL loader](https://learn.microsoft.com/en-us/archive/blogs/larryosterman/best-practices-for-dllmain). In my opinion, the document was good for its time except for the "General Best Practices" section which just throws rules at you without any structure or reasoning. People reading the old `DllMain` "General Best Practices" today (on Microsoft's documentation website; which has undergone a few updates) tend to come out more confused about `DllMain` safety after than they were before. So, let's rewrite it with the the perspective of an ecosystem where `DllMain` (module initializer/deinitializer) problems don't happen to begin with. **Enter... Unix-like operating systems!**

**Note:** This old document states the following about loader lock: "Any function that must read or modify the per-process library-loader data structures must acquire this lock before performing such an operation" (in addition to protecting module initialization/deinitialization). This fact was only true of the legacy Windows loader (e.g. see ReactOS code based on the reverse engineered Windows Server 2003 loader). The modern Windows loader protects library-loader data structures using the `LdrpModuleDatatableLock` lock.

[Current official Microsoft download.](https://download.microsoft.com/download/a/f/7/af7777e5-7dcd-4800-8a0a-b18336565f5b/DLL_bestprac.doc). [Legacy download page archived.](https://web.archive.org/web/20101029013644/http://www.microsoft.com/whdc/driver/kernel/DLL_bestprac.mspx)
