# DLL Best Practices

This is Microsoft's original document laying out the DLL best practices, namely regarding `DllMain`.

**Note:** This old document says the following in regards to loader lock: "Any function that must read or modify the per-process library-loader data structures must acquire this lock before performing such an operation" (in addition to protecting module initialization). This fact was only true of the legacy Windows loader (e.g. see ReactOS code based on the reverse engineered Windows Server 2003 loader). The modern Windows loader protects library-loader data structures using the `LdrpModuleDatatableLock` lock.

The "DLL Best Practices" document was created by the [product manager (PM)](https://medium.com/@adiagashe/microsoft-program-manager-overview-everything-you-need-to-know-from-application-to-interview-33eab7fb0dde) [who owns (or at least owned) the DLL loader](https://learn.microsoft.com/en-us/archive/blogs/larryosterman/best-practices-for-dllmain). In my opinion, the document was good for its time except for the "General Best Practices" section which just throws rules at you without any structure or reasoning. People reading the old `DllMain` "General Best Practices" today (on Microsoft's documentation website; which has undergone a few updates) tend to come out more confused about `DllMain` safety after than they were before. So, let's rewrite it with the the perspective of an ecosystem where `DllMain` (module initializer) problems don't happen to begin with. **Enter... Unix-like operating systems!**

[Current official Microsoft download.](https://download.microsoft.com/download/a/f/7/af7777e5-7dcd-4800-8a0a-b18336565f5b/DLL_bestprac.doc). [Legacy download page archived.](https://web.archive.org/web/20101029013644/http://www.microsoft.com/whdc/driver/kernel/DLL_bestprac.mspx)
